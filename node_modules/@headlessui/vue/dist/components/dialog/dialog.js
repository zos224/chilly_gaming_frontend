import{computed as c,defineComponent as y,h as D,inject as K,nextTick as ee,onMounted as M,onUnmounted as te,provide as le,ref as h,watchEffect as N}from"vue";import{render as P,Features as V}from'../../utils/render.js';import{Keys as oe}from'../../keyboard.js';import{useId as w}from'../../hooks/use-id.js';import{FocusTrap as R}from'../../components/focus-trap/focus-trap.js';import{useInertOthers as ae}from'../../hooks/use-inert-others.js';import{Portal as Y,PortalGroup as re}from'../portal/portal.js';import{StackMessage as _,useStackProvider as ie}from'../../internal/stack-context.js';import{match as F}from'../../utils/match.js';import{ForcePortalRoot as $}from'../../internal/portal-force-root.js';import{Description as ne,useDescriptions as ue}from'../description/description.js';import{dom as U}from'../../utils/dom.js';import{useOpenClosed as se,State as q}from'../../internal/open-closed.js';import{useOutsideClick as pe}from'../../hooks/use-outside-click.js';import{getOwnerDocument as de}from'../../utils/owner.js';import{useEventListener as fe}from'../../hooks/use-event-listener.js';import{Hidden as ce,Features as ge}from'../../internal/hidden.js';import{disposables as me}from'../../utils/disposables.js';import{isIOS as ve}from'../../utils/platform.js';var De=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(De||{});let j=Symbol("DialogContext");function T(a){let u=K(j,null);if(u===null){let t=new Error(`<${a} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,T),t}return u}let k="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Ne=y({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:k},initialFocus:{type:Object,default:null}},emits:{close:a=>!0},setup(a,{emit:u,attrs:t,slots:s,expose:i}){var A;let g=h(!1);M(()=>{g.value=!0});let r=h(0),d=se(),S=c(()=>a.open===k&&d!==null?F(d.value,{[q.Open]:!0,[q.Closed]:!1}):a.open),x=h(new Set),m=h(null),B=h(null),I=c(()=>de(m));if(i({el:m,$el:m}),!(a.open!==k||d!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof S.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${S.value===k?void 0:a.open}`);let f=c(()=>g.value&&S.value?0:1),H=c(()=>f.value===0),C=c(()=>r.value>1),G=K(j,null)!==null,z=c(()=>C.value?"parent":"leaf");ae(m,c(()=>C.value?H.value:!1)),ie({type:"Dialog",enabled:c(()=>f.value===0),element:m,onUpdate:(o,l,n)=>{if(l==="Dialog")return F(o,{[_.Add](){x.value.add(n),r.value+=1},[_.Remove](){x.value.delete(n),r.value-=1}})}});let J=ue({name:"DialogDescription",slot:c(()=>({open:S.value}))}),Q=`headlessui-dialog-${w()}`,E=h(null),O={titleId:E,panelRef:h(null),dialogState:f,setTitleId(o){E.value!==o&&(E.value=o)},close(){u("close",!1)}};return le(j,O),pe(()=>{var l,n,p;return[...Array.from((n=(l=I.value)==null?void 0:l.querySelectorAll("body > *, [data-headlessui-portal]"))!=null?n:[]).filter(e=>!(!(e instanceof HTMLElement)||e.contains(U(B))||O.panelRef.value&&e.contains(O.panelRef.value))),(p=O.panelRef.value)!=null?p:m.value]},(o,l)=>{O.close(),ee(()=>l==null?void 0:l.focus())},c(()=>f.value===0&&!C.value)),fe((A=I.value)==null?void 0:A.defaultView,"keydown",o=>{o.defaultPrevented||o.key===oe.Escape&&f.value===0&&(C.value||(o.preventDefault(),o.stopPropagation(),O.close()))}),N(o=>{var W;if(f.value!==0||G)return;let l=I.value;if(!l)return;let n=me();function p(v,b,X){let Z=v.style.getPropertyValue(b);return Object.assign(v.style,{[b]:X}),n.add(()=>{Object.assign(v.style,{[b]:Z})})}let e=l==null?void 0:l.documentElement,L=((W=l.defaultView)!=null?W:window).innerWidth-e.clientWidth;if(p(e,"overflow","hidden"),L>0){let v=e.clientWidth-e.offsetWidth,b=L-v;p(e,"paddingRight",`${b}px`)}if(ve()){let v=window.pageYOffset;p(e,"position","fixed"),p(e,"marginTop",`-${v}px`),p(e,"width","100%"),n.add(()=>window.scrollTo(0,v))}o(n.dispose)}),N(o=>{if(f.value!==0)return;let l=U(m);if(!l)return;let n=new IntersectionObserver(p=>{for(let e of p)e.boundingClientRect.x===0&&e.boundingClientRect.y===0&&e.boundingClientRect.width===0&&e.boundingClientRect.height===0&&O.close()});n.observe(l),o(()=>n.disconnect())}),()=>{let o={...t,ref:m,id:Q,role:"dialog","aria-modal":f.value===0?!0:void 0,"aria-labelledby":E.value,"aria-describedby":J.value},{open:l,initialFocus:n,...p}=a,e={open:f.value===0};return D($,{force:!0},()=>[D(Y,()=>D(re,{target:m.value},()=>D($,{force:!1},()=>D(R,{initialFocus:n,containers:x,features:H.value?F(z.value,{parent:R.features.RestoreFocus,leaf:R.features.All&~R.features.FocusLock}):R.features.None},()=>P({ourProps:o,theirProps:p,slot:e,attrs:t,slots:s,visible:f.value===0,features:V.RenderStrategy|V.Static,name:"Dialog"}))))),D(ce,{features:ge.Hidden,ref:B})])}}}),Ve=y({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:u,slots:t}){let s=T("DialogOverlay"),i=`headlessui-dialog-overlay-${w()}`;function g(r){r.target===r.currentTarget&&(r.preventDefault(),r.stopPropagation(),s.close())}return()=>P({ourProps:{id:i,"aria-hidden":!0,onClick:g},theirProps:a,slot:{open:s.dialogState.value===0},attrs:u,slots:t,name:"DialogOverlay"})}}),Ye=y({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"}},inheritAttrs:!1,setup(a,{attrs:u,slots:t,expose:s}){let i=T("DialogBackdrop"),g=`headlessui-dialog-backdrop-${w()}`,r=h(null);return s({el:r,$el:r}),M(()=>{if(i.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let d=a,S={id:g,ref:r,"aria-hidden":!0};return D($,{force:!0},()=>D(Y,()=>P({ourProps:S,theirProps:{...u,...d},slot:{open:i.dialogState.value===0},attrs:u,slots:t,name:"DialogBackdrop"})))}}}),_e=y({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:u,slots:t,expose:s}){let i=T("DialogPanel"),g=`headlessui-dialog-panel-${w()}`;s({el:i.panelRef,$el:i.panelRef});function r(d){d.stopPropagation()}return()=>{let d={id:g,ref:i.panelRef,onClick:r};return P({ourProps:d,theirProps:a,slot:{open:i.dialogState.value===0},attrs:u,slots:t,name:"DialogPanel"})}}}),Ue=y({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"}},setup(a,{attrs:u,slots:t}){let s=T("DialogTitle"),i=`headlessui-dialog-title-${w()}`;return M(()=>{s.setTitleId(i),te(()=>s.setTitleId(null))}),()=>P({ourProps:{id:i},theirProps:a,slot:{open:s.dialogState.value===0},attrs:u,slots:t,name:"DialogTitle"})}}),qe=ne;export{Ne as Dialog,Ye as DialogBackdrop,qe as DialogDescription,Ve as DialogOverlay,_e as DialogPanel,Ue as DialogTitle};
