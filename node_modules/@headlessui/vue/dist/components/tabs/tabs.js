import{Fragment as F,computed as x,defineComponent as h,h as D,inject as C,onMounted as O,onUnmounted as H,provide as K,ref as I,watchEffect as $}from"vue";import{Features as k,render as S,omit as G}from'../../utils/render.js';import{useId as A}from'../../hooks/use-id.js';import{Keys as m}from'../../keyboard.js';import{dom as g}from'../../utils/dom.js';import{match as N}from'../../utils/match.js';import{focusIn as P,Focus as v,FocusResult as w}from'../../utils/focus-management.js';import{useResolveButtonType as U}from'../../hooks/use-resolve-button-type.js';import{FocusSentinel as W}from'../../internal/focus-sentinel.js';import{microTask as z}from'../../utils/micro-task.js';import{Hidden as _}from'../../internal/hidden.js';import{getOwnerDocument as q}from'../../utils/owner.js';let j=Symbol("TabsContext");function E(l){let i=C(j,null);if(i===null){let o=new Error(`<${l} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,E),o}return i}let oe=h({name:"TabGroup",emits:{change:l=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(l,{slots:i,attrs:o,emit:f}){let e=I(null),s=I([]),n=I([]),c=x(()=>l.selectedIndex!==null),p=x(()=>c.value?l.selectedIndex:e.value),b={selectedIndex:e,orientation:x(()=>l.vertical?"vertical":"horizontal"),activation:x(()=>l.manual?"manual":"auto"),tabs:s,panels:n,setSelectedIndex(t){p.value!==t&&f("change",t),c.value||(e.value=t)},registerTab(t){s.value.includes(t)||s.value.push(t)},unregisterTab(t){let r=s.value.indexOf(t);r!==-1&&s.value.splice(r,1)},registerPanel(t){n.value.includes(t)||n.value.push(t)},unregisterPanel(t){let r=n.value.indexOf(t);r!==-1&&n.value.splice(r,1)}};return K(j,b),$(()=>{var R;if(b.tabs.value.length<=0||l.selectedIndex===null&&e.value!==null)return;let t=b.tabs.value.map(y=>g(y)).filter(Boolean),r=t.filter(y=>!y.hasAttribute("disabled")),d=(R=l.selectedIndex)!=null?R:l.defaultIndex;if(d<0)e.value=t.indexOf(r[0]);else if(d>b.tabs.value.length)e.value=t.indexOf(r[r.length-1]);else{let y=t.slice(0,d),u=[...t.slice(d),...y].find(T=>r.includes(T));if(!u)return;e.value=t.indexOf(u)}}),()=>{let t={selectedIndex:e.value};return D(F,[s.value.length<=0&&D(W,{onFocus:()=>{for(let r of s.value){let d=g(r);if((d==null?void 0:d.tabIndex)===0)return d.focus(),!0}return!1}}),S({theirProps:{...o,...G(l,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:t,slots:i,attrs:o,name:"TabGroup"})])}}}),se=h({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(l,{attrs:i,slots:o}){let f=E("TabList");return()=>{let e={selectedIndex:f.selectedIndex.value},s={role:"tablist","aria-orientation":f.orientation.value};return S({ourProps:s,theirProps:l,slot:e,attrs:i,slots:o,name:"TabList"})}}}),de=h({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1}},setup(l,{attrs:i,slots:o,expose:f}){let e=E("Tab"),s=`headlessui-tabs-tab-${A()}`,n=I(null);f({el:n,$el:n}),O(()=>e.registerTab(n)),H(()=>e.unregisterTab(n));let c=x(()=>e.tabs.value.indexOf(n)),p=x(()=>c.value===e.selectedIndex.value);function b(a){var T;let u=a();if(u===w.Success&&e.activation.value==="auto"){let L=(T=q(n))==null?void 0:T.activeElement,M=e.tabs.value.findIndex(B=>g(B)===L);M!==-1&&e.setSelectedIndex(M)}return u}function t(a){let u=e.tabs.value.map(L=>g(L)).filter(Boolean);if(a.key===m.Space||a.key===m.Enter){a.preventDefault(),a.stopPropagation(),e.setSelectedIndex(c.value);return}switch(a.key){case m.Home:case m.PageUp:return a.preventDefault(),a.stopPropagation(),b(()=>P(u,v.First));case m.End:case m.PageDown:return a.preventDefault(),a.stopPropagation(),b(()=>P(u,v.Last))}if(b(()=>N(e.orientation.value,{vertical(){return a.key===m.ArrowUp?P(u,v.Previous|v.WrapAround):a.key===m.ArrowDown?P(u,v.Next|v.WrapAround):w.Error},horizontal(){return a.key===m.ArrowLeft?P(u,v.Previous|v.WrapAround):a.key===m.ArrowRight?P(u,v.Next|v.WrapAround):w.Error}}))===w.Success)return a.preventDefault()}let r=I(!1);function d(){var a;r.value||(r.value=!0,!l.disabled&&((a=g(n))==null||a.focus(),e.setSelectedIndex(c.value),z(()=>{r.value=!1})))}function R(a){a.preventDefault()}let y=U(x(()=>({as:l.as,type:i.type})),n);return()=>{var T;let a={selected:p.value},u={ref:n,onKeydown:t,onMousedown:R,onClick:d,id:s,role:"tab",type:y.value,"aria-controls":(T=g(e.panels.value[c.value]))==null?void 0:T.id,"aria-selected":p.value,tabIndex:p.value?0:-1,disabled:l.disabled?!0:void 0};return S({ourProps:u,theirProps:l,slot:a,attrs:i,slots:o,name:"Tab"})}}}),fe=h({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(l,{slots:i,attrs:o}){let f=E("TabPanels");return()=>{let e={selectedIndex:f.selectedIndex.value};return S({theirProps:l,ourProps:{},slot:e,attrs:o,slots:i,name:"TabPanels"})}}}),ce=h({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0}},setup(l,{attrs:i,slots:o,expose:f}){let e=E("TabPanel"),s=`headlessui-tabs-panel-${A()}`,n=I(null);f({el:n,$el:n}),O(()=>e.registerPanel(n)),H(()=>e.unregisterPanel(n));let c=x(()=>e.panels.value.indexOf(n)),p=x(()=>c.value===e.selectedIndex.value);return()=>{var r;let b={selected:p.value},t={ref:n,id:s,role:"tabpanel","aria-labelledby":(r=g(e.tabs.value[c.value]))==null?void 0:r.id,tabIndex:p.value?0:-1};return!p.value&&l.unmount&&!l.static?D(_,{as:"span",...t}):S({ourProps:t,theirProps:l,slot:b,attrs:i,slots:o,features:k.Static|k.RenderStrategy,visible:p.value,name:"TabPanel"})}}});export{de as Tab,oe as TabGroup,se as TabList,ce as TabPanel,fe as TabPanels};
